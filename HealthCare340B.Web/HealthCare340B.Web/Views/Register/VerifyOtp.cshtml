@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = null;
}
<form id="frmOTP" asp-controller="Register" asp-action="VerifyOtp" method="post">
    <div class="card mb-0">
        <div class="card-body">
            <div class="input-group mb-3">
                <label class="input-group-text col-3 text-white-600" for="txtEmail">OTP</label>
                <input id="txtOTP" type="text" class="form-control col-9" name="otp" />
            </div>
        </div>
        <div class="card-footer ">
            <div class="text-center">
                <button type="submit" class="btn btn-primary text-lg fs-10">
                    <span>Kirim OTP</span>
                </button>
            </div>
        </div>
    </div>
</form>

<script>


    $("#staticModalLabelLg").text("@ViewBag.Title");

    $("#btnsendOTP").click(function (e) {
        e.preventDefault(); // Mencegah pengiriman formulir default

        $.ajax({
            url: "/Register/VerifyOtpAsync", // URL yang benar
            type: "POST",
            data: $("#frmOTP").serialize(),
            dataType: "json",
            beforeSend: () => { },

            success: function (response) {
                if (response.statusCode == 201 || response.statusCode == 200) {
                    $("#staticModalLgBody").load("/Register/ConfirmPassword");
                    $("#staticModalLg").modal('show');
                } else {
                    alert(response.message);
                }
            },
            error: function (errResponse) {
                console.error(errResponse);
                alert("Terjadi kesalahan. Silakan coba lagi.");
            }
        });
    });


    let timer;
    function startCountdown() {
        let timeLeft = 180;
        timer = setInterval(function () {
            let minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            if (seconds < 10) seconds = '0' + seconds;
            $("#countdown").text('${minutes} : ${seconds}');
            if (timeLeft <= 0) {
                clearInterval(timer);
                $('#countdown').text('Kirim ulang OTP');
            }
            timeLeft--;
        }, 1000)
    }

</script>